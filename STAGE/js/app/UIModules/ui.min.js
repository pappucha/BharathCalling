"use strict";!function($,angular,window,undefined){function CheckboxRadioDirective($timeout,$parse){return{require:"ngModel",scope:{viewValue:"=ngModel"},link:function($scope,element,$attrs){return $scope.$watch("viewValue",function(){$(element).ionCheckRadio()}),$timeout(function(){var value;return value=$parse($attrs.ngValue)($scope),$(element).ionCheckRadio().on("change",function(event){return"checkbox"===$(element).attr("type")&&$scope.$apply(function(){return $scope.viewValue=event.target.checked}),"radio"===$(element).attr("type")?$scope.$apply(function(){return $scope.viewData=value}):void 0})})}}}angular.module("glams.components.ui",["glams.ui.tabs","glams.ui.collapsible","glams.ui.accordion","glams.ui.customSelect","glams.ui.checkboxradio","glams.ui.datepicker","glams.ui.modal","glams.ui.grids","glams.ui.upload","glams.ui.colorpicker","glams.ui.tree"]),angular.module("glams.ui.tabs",[]).controller("TabsetController",["$scope",function($scope){var ctrl=this,tabs=ctrl.tabs=$scope.tabs=[];ctrl.select=function(selectedTab){angular.forEach(tabs,function(tab){tab.active&&tab!==selectedTab&&(tab.active=!1,tab.onDeselect())}),selectedTab.active=!0,selectedTab.onSelect()},ctrl.addTab=function(tab){tabs.push(tab),1===tabs.length?tab.active=!0:tab.active&&ctrl.select(tab)},ctrl.removeTab=function(tab){var index=tabs.indexOf(tab);if(tab.active&&tabs.length>1){var newActiveIndex=index==tabs.length-1?index-1:index+1;ctrl.select(tabs[newActiveIndex])}tabs.splice(index,1)}}]).directive("tabset",function($timeout){return{restrict:"EA",transclude:!0,replace:!0,scope:{},controller:"TabsetController",template:["<div>","<ul class=\"nav nav-{{type || 'tabs'}}\" ng-class=\"{'nav-stacked': vertical, 'nav-justified': justified}\" ng-transclude></ul>",'<div class="tab-content">','<div class="tab-pane" ng-repeat="tab in tabs" ng-class="{active: tab.active}" tab-content-transclude="tab"></div>',"</div>","</div>"].join(""),link:function(scope,element,attrs){scope.vertical=angular.isDefined(attrs.vertical)?scope.$parent.$eval(attrs.vertical):!1,scope.vertical&&$timeout(function(){$(element).find(".tab-content").css("minHeight",$(element).find(".nav-tabs").first().height()+"px")},100),scope.justified=angular.isDefined(attrs.justified)?scope.$parent.$eval(attrs.justified):!1}}}).directive("tab",["$parse",function($parse){return{require:"^tabset",restrict:"EA",replace:!0,template:['<li ng-class="{active: active, disabled: disabled}">','<a ng-click="select()" tab-heading-transclude>{{heading}}</a>',"</li>"].join(""),transclude:!0,scope:{heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},compile:function(elm,attrs,transclude){return function(scope,elm,attrs,tabsetCtrl){scope.disabled=attrs.disabled?!0:!1,scope.active=attrs.active?!!$parse(attrs.active)():!1,scope.select=function(){scope.disabled||(scope.active=!0)},scope.$watch("active",function(active){active&&!scope.disabled&&tabsetCtrl.select(scope)}),tabsetCtrl.addTab(scope),scope.$on("$destroy",function(){tabsetCtrl.removeTab(scope)}),scope.$transcludeFn=transclude}}}}]).directive("tabHeadingTransclude",[function(){return{restrict:"A",require:"^tab",link:function(scope,elm){scope.$watch("headingElement",function(heading){heading&&(elm.html(""),elm.append(heading))})}}}]).directive("tabContentTransclude",function(){function isTabHeading(node){return node.tagName&&(node.hasAttribute("tab-heading")||node.hasAttribute("data-tab-heading")||"tab-heading"===node.tagName.toLowerCase()||"data-tab-heading"===node.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(scope,elm,attrs){var tab=scope.$eval(attrs.tabContentTransclude);tab.$transcludeFn(tab.$parent,function(contents){angular.forEach(contents,function(node){isTabHeading(node)?tab.headingElement=node:elm.append(node)})})}}}),angular.module("glams.ui.collapsible",[]).controller("CollapsibleController",["$scope",function(){}]).directive("collapsiblePanel",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{heading:"@",collapsed:"=?",iconClass:"@"},controller:"CollapsibleController",template:['<div class="collapsible">','<div class="collapsible-head">','<span class="icon {{iconClass}}"></span> ','<span class="collapsible-head-text">{{heading}}</span> ',"<span class=\"collapsible-status-icon fa fa-{{collapsed?'plus':'minus'}}\" ng-click=\"collapsed=!collapsed\"></span>","</div>",'<div class="collapsible-content clearfix" ng-transclude></div>',"</div>"].join(""),link:function(scope,element){scope.$watch("collapsed",function(collapsed){collapsed?$(element).find(".collapsible-content").slideUp(150,function(){$(element).addClass("collapsed")}):($(element).removeClass("collapsed"),$(element).find(".collapsible-content").slideDown(150))})}}}),angular.module("glams.ui.accordion",[]).directive("accordion",function(){return{restrict:"EA",transclude:!0,scope:{closeOthers:"=?"},controller:function($scope){$scope.closeOthers=$scope.closeOthers==undefined?!0:$scope.closeOthers,$scope.accordionGroup=[],this.addAccordion=function(pane){$scope.accordionGroup.push(pane)},this.select=function(ag){$scope.closeOthers?(this.closeAll(ag),ag.collapsed=!1):ag.collapsed=!ag.collapsed},this.closeAll=function(ag){$.each($scope.accordionGroup,function(i,a){a!==ag&&(a.collapsed=!0)})}},link:function(){},template:'<div class="accordion" ng-transclude></div>',replace:!0}}).directive("accordionGroup",function(){var count=0;return{require:"^accordion",restrict:"EA",transclude:!0,scope:{heading:"@",iconClass:"@"},template:['<div class="accordion-group">','<div class="accordion-head" ng-click="select()"><span class="icon {{iconClass}}"></span><span class="accordion-head-text">{{heading}}</span></div>','<div class="accordion-content clearfix" ng-transclude></div>',"</div>"].join(""),controller:function(){},link:function(scope,element,attrs,accordionCntrl){accordionCntrl.addAccordion(scope),scope.active=!!attrs.active,scope.collapsed=!0,scope.active?(count++,accordionCntrl.select(scope)):0===count&&(count++,accordionCntrl.select(scope)),scope.select=function(){accordionCntrl.select(scope)},scope.$watch("collapsed",function(collapsed){collapsed?$(element).find(".accordion-content").slideUp(150,function(){$(element).addClass("collapsed")}):($(element).removeClass("collapsed"),$(element).find(".accordion-content").slideDown(150))})},replace:!0}}),$.fn.setVal=function(value){var el=$(this),x=value===undefined?el.val():el.val(value);return el.refresh(),x},$.fn.refresh=function(){return $(this).trigger("refresh:custom")},angular.module("glams.ui.customSelect",[]).directive("customSelect",function($compile,$timeout){var template=['<div class="custom-select" ng-class="{disabled: disabled}" ng-click="toggle()" tabindex="0" ng-style="{width:width}">','<ul class="selected-list" ng-if="multiSelect" ng-if="selectedList.length>0">','<li tabindex="-1" ng-repeat="list in selectedList track by $index" value="{{list.value}}" ng-click="$event.stopPropagation()">','{{list.text}} <span class="fa fa-times" ng-click="remove(list)" title="remove"></span>',"</li>","</ul>",'<span class="selected-list" ng-if="selectedList.length==0">&nbsp;</span>','<span class="selected-list" ng-if="!multiSelect && selectedList.length>0">&nbsp;{{selectedList[0].text}}</span>','<i class="ic fa fa-sort-desc"></i>','<div class="select-list" ng-show="active">','<input type="text" class="form-control" ng-focus="active" ng-click="$event.stopPropagation()" ng-model="filter"/>','<span class="fbtn fa fa-check-square-o" ng-click="selectAll($event)" ng-if="multiSelect" title="select all"></span>','<span class="fbtn fa fa-undo reset" ng-click="resetToDefault($event)" ng-if="multiSelect" title="reset"></span>','<span class="fbtn fa fa-eraser clear" ng-click="clearSelection($event)" ng-if="multiSelect" title="clear"></span>','<i class="fa fa-search"></i>','<div class="select-list-container">',"<ul>",'<li ng-repeat="l in lists | filter:filter" ng-click="select($event, l)" ng-class="{active:inSelection(l)}">&nbsp;{{l.text}}</li>',"</ul>","</div>","</div>","</div>"].join("");return{restrict:"A",require:"ngModel",scope:{viewData:"=ngModel",width:"@width",optionData:"=customSelect",change:"&ngChange",blur:"&ngBlur"},controller:function(){},link:function(){},compile:function(){return function(scope,elm){scope.active=!1,scope.lists=[],scope.selectedList=[],scope.defaultValue=[],scope.multiSelect=$(elm).attr("multiple")?!0:!1,scope.disabled=$(elm).attr("disabled")?!0:!1,scope.update=function(value){scope.viewData=value,$(elm).val(value),setTimeout(function(){scope.$apply(),scope.change(),scope.blur()},0)},scope.resetPosition=function(){if(scope.active){var el=$(scope.sElm).find(".select-list");$(scope.sElm).removeClass("showBottom"),$(scope.sElm).removeClass("showTop");var ht=el.offset().top-$("main.content-area").offset().top+el.height();$(scope.sElm).addClass(ht>$("main.content-area").height()?"showTop":"showBottom")}},scope.getVal=function(){var eVal=scope.viewData||$(elm).val();return null==eVal&&(eVal=scope.multiSelect?[]:""),eVal},scope.hasValue=function(value){var eVal=scope.getVal();if("string"==typeof eVal)return eVal==value;var flag=!1;return $.each(eVal,function(i,v){v==value&&(flag=!0)}),flag},scope.init=function(){scope.populateListData()},scope.populateListData=function(){var firstObj={};scope.selectedList.splice(0,scope.selectedList.length),scope.defaultValue.splice(0,scope.defaultValue.length),scope.lists.splice(0,scope.lists.length),$(elm).find("option").each(function(i,o){var value=$(o).attr("value"),text=$(o).text(),obj={value:value!=undefined?value:text,text:text};0==i&&(firstObj=obj),scope.lists.push(obj)}),scope.setSelectedItem()},setTimeout(function(){scope.init(),scope.$apply()},10),scope.setSelectedItem=function(){var valueList=scope.getVal();if(scope.multiSelect){var v=valueList instanceof Array?valueList:[valueList];$.each(v,function(i,vl){$.each(scope.lists,function(j,l){vl==l.value&&(scope.selectedList.push(l),scope.defaultValue.push(l))})})}else{var v=valueList instanceof Array?valueList[0]:valueList;$.each(scope.lists,function(j,l){v==l.value&&(scope.selectedList.splice(0,scope.selectedList.length),scope.defaultValue.splice(0,scope.defaultValue.length),scope.selectedList.push(l),scope.defaultValue.push(l))})}},scope.toggle=function(){scope.disabled?scope.active=!1:(scope.active||$(scope.sElm).find(".select-list").removeClass("ng-hide"),scope.active=!scope.active,scope.filter="",setTimeout(scope.resetPosition,50)),scope.populateListData()},scope.select=function(event,list){event.stopPropagation();var index=$.inArray(list,scope.selectedList);-1==index?(!scope.multiSelect&&scope.selectedList.length>0&&scope.clearSelection(event),scope.selectedList.push(list)):scope.remove(list),scope.multiSelect||(scope.active=!1),scope.update(scope.getValue())},scope.resetToDefault=function(evt){evt.stopPropagation(),scope.clearSelection(evt),$(scope.defaultValue).each(function(){scope.selectedList.push(this)}),scope.update(scope.getValue())},scope.selectAll=function(evt){evt.stopPropagation(),scope.clearSelection(evt),$(scope.lists).each(function(){scope.selectedList.push(this)}),scope.update(scope.getValue())},scope.clearSelection=function(evt){evt.stopPropagation(),scope.selectedList.splice(0,scope.selectedList.length)},scope.getValue=function(){if(1==scope.selectedList.length)return scope.selectedList[0].value;var value=[];return $(scope.selectedList).each(function(i,v){value.push(v.value)}),value},scope.remove=function(list){if(!scope.disabled){var index=$.inArray(list,scope.selectedList);index>=0&&(!scope.multiSelect&&scope.selectedList.length>1||scope.multiSelect)&&scope.selectedList.splice(index,1),scope.update(scope.getValue())}},scope.inSelection=function(list){var index=$.inArray(list,scope.selectedList);return index>=0?(scope.multiSelect||(scope.selectedList.splice(0,scope.selectedList.length),scope.selectedList.push(list)),!0):!1},scope.sElm=$compile(template)(scope)[0],$(elm).hide(),$(elm).hasClass("no-fluid")&&$(scope.sElm).addClass("no-fluid"),$(elm).after(scope.sElm),$(elm).on("refresh:custom",function(){scope.init(),scope.$apply(function(){scope.update(scope.getValue())})}),$(document).on("click",function(event){0==$(scope.sElm).find(event.target).length&&event.target!=scope.sElm&&(scope.active=!1,setTimeout(function(){$(scope.sElm).find(".select-list").addClass("ng-hide")},0))}),$(scope.sElm).on("keydown",function(evt){27===evt.which?(evt.preventDefault(),evt.stopPropagation(),scope.active=!1):40!==evt.which||scope.isOpen||(scope.active=!0),scope.$apply()}),$(window).on("resize",scope.resetPosition),$("main.content-area").on("scroll",scope.resetPosition),scope.$watch("disabled",function(disabled){scope.disabled=disabled?!0:!1}),scope.$watch("viewData",function(){scope.init(),$timeout(function(){scope.init()})}),scope.$watch("optionData",function(){scope.populateListData(),$timeout(function(){scope.init()})})}}}}),angular.module("glams.ui.checkboxradio",[]).directive("customCheckbox",CheckboxRadioDirective).directive("customRadio",CheckboxRadioDirective),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].documentElement.scrollLeft)}},positionElements:function(hostEl,targetEl,positionStr,appendToBody){var hostElPos,targetElWidth,targetElHeight,targetElPos,positionStrParts=positionStr.split("-"),pos0=positionStrParts[0],pos1=positionStrParts[1]||"center";hostElPos=appendToBody?this.offset(hostEl):this.position(hostEl),targetElWidth=targetEl.prop("offsetWidth"),targetElHeight=targetEl.prop("offsetHeight");var shiftWidth={center:function(){return hostElPos.left+hostElPos.width/2-targetElWidth/2},left:function(){return hostElPos.left},right:function(){return hostElPos.left+hostElPos.width}},shiftHeight={center:function(){return hostElPos.top+hostElPos.height/2-targetElHeight/2},top:function(){return hostElPos.top},bottom:function(){return hostElPos.top+hostElPos.height}};switch(pos0){case"right":targetElPos={top:shiftHeight[pos1](),left:shiftWidth[pos0]()};break;case"left":targetElPos={top:shiftHeight[pos1](),left:hostElPos.left-targetElWidth};break;case"bottom":targetElPos={top:shiftHeight[pos0](),left:shiftWidth[pos1]()};break;default:targetElPos={top:hostElPos.top-targetElHeight,left:shiftWidth[pos1]()}}return targetElPos}}}]),angular.module("ui.bootstrap.dateparser",[]).service("dateParser",["$locale","orderByFilter",function($locale,orderByFilter){function createParser(format){var map=[],regex=format.split("");return angular.forEach(formatCodeToRegex,function(data,code){var index=format.indexOf(code);if(index>-1){format=format.split(""),regex[index]="("+data.regex+")",format[index]="$";for(var i=index+1,n=index+code.length;n>i;i++)regex[i]="",format[i]="$";format=format.join(""),map.push({index:index,apply:data.apply})}}),{regex:new RegExp("^"+regex.join("")+"$"),map:orderByFilter(map,"index")}}function isValid(year,month,date){return 1===month&&date>28?29===date&&(year%4===0&&year%100!==0||year%400===0):3===month||5===month||8===month||10===month?31>date:!0}this.parsers={};var formatCodeToRegex={yyyy:{regex:"\\d{4}",apply:function(value){this.year=+value}},yy:{regex:"\\d{2}",apply:function(value){this.year=+value+2e3}},y:{regex:"\\d{1,4}",apply:function(value){this.year=+value}},MMMM:{regex:$locale.DATETIME_FORMATS.MONTH.join("|"),apply:function(value){this.month=$locale.DATETIME_FORMATS.MONTH.indexOf(value)}},MMM:{regex:$locale.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(value){this.month=$locale.DATETIME_FORMATS.SHORTMONTH.indexOf(value)}},MM:{regex:"0[1-9]|1[0-2]",apply:function(value){this.month=value-1}},M:{regex:"[1-9]|1[0-2]",apply:function(value){this.month=value-1}},dd:{regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(value){this.date=+value}},d:{regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(value){this.date=+value}},EEEE:{regex:$locale.DATETIME_FORMATS.DAY.join("|")},EEE:{regex:$locale.DATETIME_FORMATS.SHORTDAY.join("|")}};this.parse=function(input,format){if(!angular.isString(input)||!format)return input;format=$locale.DATETIME_FORMATS[format]||format,this.parsers[format]||(this.parsers[format]=createParser(format));var parser=this.parsers[format],regex=parser.regex,map=parser.map,results=input.match(regex);if(results&&results.length){for(var dt,fields={year:1900,month:0,date:1,hours:0},i=1,n=results.length;n>i;i++){var mapper=map[i-1];mapper.apply&&mapper.apply.call(fields,results[i])}return isValid(fields.year,fields.month,fields.date)&&(dt=new Date(fields.year,fields.month,fields.date,fields.hours)),dt}}}]),angular.module("glams.ui.datepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).constant("datepickerConfig",{formatDay:"dd",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM yyyy",formatMonthTitle:"yyyy",datepickerMode:"day",minMode:"day",maxMode:"year",showWeeks:!1,startingDay:0,yearRange:20,minDate:null,maxDate:null}).controller("DatepickerController",["$scope","$attrs","$parse","$interpolate","$timeout","$log","dateFilter","datepickerConfig",function($scope,$attrs,$parse,$interpolate,$timeout,$log,dateFilter,datepickerConfig){var self=this,ngModelCtrl={$setViewValue:angular.noop};this.modes=["day","month","year"],angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle","minMode","maxMode","showWeeks","startingDay","yearRange"],function(key,index){self[key]=angular.isDefined($attrs[key])?8>index?$interpolate($attrs[key])($scope.$parent):$scope.$parent.$eval($attrs[key]):datepickerConfig[key]}),angular.forEach(["minDate","maxDate"],function(key){$attrs[key]?$scope.$parent.$watch($parse($attrs[key]),function(value){self[key]=value?new Date(value):null,self.refreshView()}):self[key]=datepickerConfig[key]?new Date(datepickerConfig[key]):null}),$scope.datepickerMode=$scope.datepickerMode||datepickerConfig.datepickerMode,$scope.uniqueId="datepicker-"+$scope.$id+"-"+Math.floor(1e4*Math.random()),this.activeDate=angular.isDefined($attrs.initDate)?$scope.$parent.$eval($attrs.initDate):new Date,$scope.isActive=function(dateObject){return 0===self.compare(dateObject.date,self.activeDate)?($scope.activeDateId=dateObject.uid,!0):!1},this.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$render=function(){self.render()}},this.render=function(){if(ngModelCtrl.$modelValue){var date=new Date(ngModelCtrl.$modelValue),isValid=!isNaN(date);isValid?this.activeDate=date:$log.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),ngModelCtrl.$setValidity("date",isValid)}this.refreshView()},this.refreshView=function(){if(this.element){this._refreshView();var date=ngModelCtrl.$modelValue?new Date(ngModelCtrl.$modelValue):null;ngModelCtrl.$setValidity("date-disabled",!date||this.element&&!this.isDisabled(date))}},this.createDateObject=function(date,format){var model=ngModelCtrl.$modelValue?new Date(ngModelCtrl.$modelValue):null;return{date:date,label:dateFilter(date,format),selected:model&&0===this.compare(date,model),disabled:this.isDisabled(date),current:0===this.compare(date,new Date)}},this.isDisabled=function(date){return this.minDate&&this.compare(date,this.minDate)<0||this.maxDate&&this.compare(date,this.maxDate)>0||$attrs.dateDisabled&&$scope.dateDisabled({date:date,mode:$scope.datepickerMode})},this.split=function(arr,size){for(var arrays=[];arr.length>0;)arrays.push(arr.splice(0,size));return arrays},$scope.select=function(date){if($scope.datepickerMode===self.minMode){var dt=ngModelCtrl.$modelValue?new Date(ngModelCtrl.$modelValue):new Date(0,0,0,0,0,0,0);dt.setFullYear(date.getFullYear(),date.getMonth(),date.getDate()),ngModelCtrl.$setViewValue(dt),ngModelCtrl.$render()}else self.activeDate=date,$scope.datepickerMode=self.modes[self.modes.indexOf($scope.datepickerMode)-1]},$scope.move=function(direction){var year=self.activeDate.getFullYear()+direction*(self.step.years||0),month=self.activeDate.getMonth()+direction*(self.step.months||0);self.activeDate.setFullYear(year,month,1),self.refreshView()},$scope.toggleMode=function(direction){direction=direction||1,$scope.datepickerMode===self.maxMode&&1===direction||$scope.datepickerMode===self.minMode&&-1===direction||($scope.datepickerMode=self.modes[self.modes.indexOf($scope.datepickerMode)+direction])},$scope.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"};var focusElement=function(){$timeout(function(){self.element[0].focus()},0,!1)};$scope.$on("datepicker.focus",focusElement),$scope.keydown=function(evt){var key=$scope.keys[evt.which];if(key&&!evt.shiftKey&&!evt.altKey)if(evt.preventDefault(),evt.stopPropagation(),"enter"===key||"space"===key){if(self.isDisabled(self.activeDate))return;$scope.select(self.activeDate),focusElement()}else!evt.ctrlKey||"up"!==key&&"down"!==key?(self.handleKeyDown(key,evt),self.refreshView()):($scope.toggleMode("up"===key?1:-1),focusElement())}}]).directive("datepicker",function(){return{restrict:"EA",replace:!0,template:['<div ng-switch="datepickerMode" role="application" ng-keydown="keydown($event)" class="datepicker inline">','<daypicker ng-switch-when="day" tabindex="0"></daypicker>','<monthpicker ng-switch-when="month" tabindex="0"></monthpicker>','<yearpicker ng-switch-when="year" tabindex="0"></yearpicker>',"</div>"].join(""),scope:{datepickerMode:"=?",dateDisabled:"&"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(scope,element,attrs,ctrls){var datepickerCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&datepickerCtrl.init(ngModelCtrl)}}}).directive("daypicker",["dateFilter",function(dateFilter){return{restrict:"EA",replace:!0,template:['<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">',"<thead>","<tr>",'<th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>','<th colspan="{{5 + showWeeks}}"><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="msel btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>','<th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>',"</tr>","<tr>",'<th ng-show="showWeeks" class="text-center"></th>','<th ng-repeat="label in labels track by $index" class="text-center"><small aria-label="{{label.full}}">{{label.abbr}}</small></th>',"</tr>","</thead>","<tbody>",'<tr ng-repeat="row in rows track by $index">','<td ng-show="showWeeks" class="text-center h6"><em>{{ weekNumbers[$index] }}</em></td>','<td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">','<button type="button" style="width:100%;" class="btn btn-default btn-sm" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-muted\': dt.secondary, \'text-info\': dt.current}">{{dt.label}}</span></button>',"</td>","</tr>","</tbody>","</table>"].join(""),require:"^datepicker",link:function(scope,element,attrs,ctrl){function getDaysInMonth(year,month){return 1!==month||year%4!==0||year%100===0&&year%400!==0?DAYS_IN_MONTH[month]:29}function getDates(startDate,n){var dates=new Array(n),current=new Date(startDate),i=0;for(current.setHours(12);n>i;)dates[i++]=new Date(current),current.setDate(current.getDate()+1);return dates}function getISO8601WeekNumber(date){var checkDate=new Date(date);checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();return checkDate.setMonth(0),checkDate.setDate(1),Math.floor(Math.round((time-checkDate)/864e5)/7)+1}scope.showWeeks=ctrl.showWeeks,ctrl.step={months:1},ctrl.element=element;var DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];ctrl._refreshView=function(){var year=ctrl.activeDate.getFullYear(),month=ctrl.activeDate.getMonth(),firstDayOfMonth=new Date(year,month,1),difference=ctrl.startingDay-firstDayOfMonth.getDay(),numDisplayedFromPreviousMonth=difference>0?7-difference:-difference,firstDate=new Date(firstDayOfMonth);numDisplayedFromPreviousMonth>0&&firstDate.setDate(-numDisplayedFromPreviousMonth+1);for(var days=getDates(firstDate,42),i=0;42>i;i++)days[i]=angular.extend(ctrl.createDateObject(days[i],ctrl.formatDay),{secondary:days[i].getMonth()!==month,uid:scope.uniqueId+"-"+i});scope.labels=new Array(7);for(var j=0;7>j;j++)scope.labels[j]={abbr:dateFilter(days[j].date,ctrl.formatDayHeader),full:dateFilter(days[j].date,"EEEE")};if(scope.title=dateFilter(ctrl.activeDate,ctrl.formatDayTitle),scope.rows=ctrl.split(days,7),scope.showWeeks){scope.weekNumbers=[];for(var weekNumber=getISO8601WeekNumber(scope.rows[0][0].date),numWeeks=scope.rows.length;scope.weekNumbers.push(weekNumber++)<numWeeks;);}},ctrl.compare=function(date1,date2){return new Date(date1.getFullYear(),date1.getMonth(),date1.getDate())-new Date(date2.getFullYear(),date2.getMonth(),date2.getDate())},ctrl.handleKeyDown=function(key){var date=ctrl.activeDate.getDate();if("left"===key)date-=1;else if("up"===key)date-=7;else if("right"===key)date+=1;else if("down"===key)date+=7;else if("pageup"===key||"pagedown"===key){var month=ctrl.activeDate.getMonth()+("pageup"===key?-1:1);ctrl.activeDate.setMonth(month,1),date=Math.min(getDaysInMonth(ctrl.activeDate.getFullYear(),ctrl.activeDate.getMonth()),date)}else"home"===key?date=1:"end"===key&&(date=getDaysInMonth(ctrl.activeDate.getFullYear(),ctrl.activeDate.getMonth()));ctrl.activeDate.setDate(date)},ctrl.refreshView()}}}]).directive("monthpicker",["dateFilter",function(dateFilter){return{restrict:"EA",replace:!0,template:['<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">',"<thead>","<tr>",'<th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>','<th><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="msel btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>','<th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>',"</tr>","</thead>","<tbody>",'<tr ng-repeat="row in rows track by $index">','<td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">','<button type="button" style="width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-info\': dt.current}">{{dt.label}}</span></button>',"</td>","</tr>","</tbody>","</table>"].join(""),require:"^datepicker",link:function(scope,element,attrs,ctrl){ctrl.step={years:1},ctrl.element=element,ctrl._refreshView=function(){for(var months=new Array(12),year=ctrl.activeDate.getFullYear(),i=0;12>i;i++)months[i]=angular.extend(ctrl.createDateObject(new Date(year,i,1),ctrl.formatMonth),{uid:scope.uniqueId+"-"+i});scope.title=dateFilter(ctrl.activeDate,ctrl.formatMonthTitle),scope.rows=ctrl.split(months,3)},ctrl.compare=function(date1,date2){return new Date(date1.getFullYear(),date1.getMonth())-new Date(date2.getFullYear(),date2.getMonth())},ctrl.handleKeyDown=function(key){var date=ctrl.activeDate.getMonth();if("left"===key)date-=1;else if("up"===key)date-=3;else if("right"===key)date+=1;else if("down"===key)date+=3;else if("pageup"===key||"pagedown"===key){var year=ctrl.activeDate.getFullYear()+("pageup"===key?-1:1);ctrl.activeDate.setFullYear(year)}else"home"===key?date=0:"end"===key&&(date=11);ctrl.activeDate.setMonth(date)},ctrl.refreshView()}}}]).directive("yearpicker",["dateFilter",function(){return{restrict:"EA",replace:!0,template:['<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">',"<thead>","<tr>",'<th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>','<th colspan="3"><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="msel btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>','<th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>',"</tr>","</thead>","<tbody>",'<tr ng-repeat="row in rows track by $index">','<td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">','<button type="button" style="width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-info\': dt.current}">{{dt.label}}</span></button>',"</td>","</tr>","</tbody>","</table>"].join(""),require:"^datepicker",link:function(scope,element,attrs,ctrl){function getStartingYear(year){return parseInt((year-1)/range,10)*range+1}var range=ctrl.yearRange;ctrl.step={years:range},ctrl.element=element,ctrl._refreshView=function(){for(var years=new Array(range),i=0,start=getStartingYear(ctrl.activeDate.getFullYear());range>i;i++)years[i]=angular.extend(ctrl.createDateObject(new Date(start+i,0,1),ctrl.formatYear),{uid:scope.uniqueId+"-"+i});scope.title=[years[0].label,years[range-1].label].join(" - "),scope.rows=ctrl.split(years,5)},ctrl.compare=function(date1,date2){return date1.getFullYear()-date2.getFullYear()},ctrl.handleKeyDown=function(key){var date=ctrl.activeDate.getFullYear();"left"===key?date-=1:"up"===key?date-=5:"right"===key?date+=1:"down"===key?date+=5:"pageup"===key||"pagedown"===key?date+=("pageup"===key?-1:1)*ctrl.step.years:"home"===key?date=getStartingYear(ctrl.activeDate.getFullYear()):"end"===key&&(date=getStartingYear(ctrl.activeDate.getFullYear())+range-1),ctrl.activeDate.setFullYear(date)
},ctrl.refreshView()}}}]).constant("datepickerPopupConfig",{datepickerPopup:"yyyy-MM-dd",currentText:"Today",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!0}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","dateParser","datepickerPopupConfig",function($compile,$parse,$document,$position,dateFilter,dateParser,datepickerPopupConfig){return{restrict:"EA",require:"ngModel",scope:{isOpen:"=?",currentText:"@",clearText:"@",closeText:"@",dateDisabled:"&"},link:function(scope,element,attrs,ngModel){function cameltoDash(string){return string.replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()})}function parseDate(viewValue){if(viewValue){if(angular.isDate(viewValue)&&!isNaN(viewValue))return ngModel.$setValidity("date",!0),viewValue;if(angular.isString(viewValue)){var date=dateParser.parse(viewValue,dateFormat)||new Date(viewValue);return isNaN(date)?(ngModel.$setValidity("date",!1),undefined):(ngModel.$setValidity("date",!0),date)}return ngModel.$setValidity("date",!1),undefined}return ngModel.$setValidity("date",!0),null}scope.isOpen=!1;var dateFormat,closeOnDateSelection=angular.isDefined(attrs.closeOnDateSelection)?scope.$parent.$eval(attrs.closeOnDateSelection):datepickerPopupConfig.closeOnDateSelection,appendToBody=angular.isDefined(attrs.datepickerAppendToBody)?scope.$parent.$eval(attrs.datepickerAppendToBody):datepickerPopupConfig.appendToBody;scope.showButtonBar=angular.isDefined(attrs.showButtonBar)?scope.$parent.$eval(attrs.showButtonBar):datepickerPopupConfig.showButtonBar,scope.getText=function(key){return scope[key+"Text"]||datepickerPopupConfig[key+"Text"]},attrs.$observe("datepickerPopup",function(value){dateFormat=value||datepickerPopupConfig.datepickerPopup,ngModel.$render()});var popupEl=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");popupEl.attr({"ng-model":"date","ng-change":"dateSelection()"});var datepickerEl=angular.element(popupEl.children()[0]);attrs.datepickerOptions&&angular.forEach(scope.$parent.$eval(attrs.datepickerOptions),function(value,option){datepickerEl.attr(cameltoDash(option),value)}),scope.watchData={},angular.forEach(["minDate","maxDate","datepickerMode"],function(key){if(attrs[key]){var getAttribute=$parse(attrs[key]);if(scope.$parent.$watch(getAttribute,function(value){scope.watchData[key]=value}),datepickerEl.attr(cameltoDash(key),"watchData."+key),"datepickerMode"===key){var setAttribute=getAttribute.assign;scope.$watch("watchData."+key,function(value,oldvalue){value!==oldvalue&&setAttribute(scope.$parent,value)})}}}),attrs.dateDisabled&&datepickerEl.attr("date-disabled","dateDisabled({ date: date, mode: mode })"),ngModel.$parsers.unshift(parseDate),scope.dateSelection=function(dt){angular.isDefined(dt)&&(scope.date=dt),ngModel.$setViewValue(scope.date),ngModel.$render(),closeOnDateSelection&&(scope.isOpen=!1,element[0].focus())},element.bind("input change keyup",function(){scope.$apply(function(){scope.date=ngModel.$modelValue})}),ngModel.$render=function(){var date=ngModel.$viewValue?dateFilter(ngModel.$viewValue,dateFormat):"";element.val(date),scope.date=parseDate(ngModel.$modelValue)};var documentClickBind=function(event){scope.isOpen&&event.target!==element[0]&&scope.$apply(function(){scope.isOpen=!1})},keydown=function(evt){scope.keydown(evt)};element.bind("keydown",keydown),scope.keydown=function(evt){27===evt.which?(evt.preventDefault(),evt.stopPropagation(),scope.close()):40!==evt.which||scope.isOpen||(scope.isOpen=!0)},scope.$watch("isOpen",function(value){value?(scope.$broadcast("datepicker.focus"),scope.position=appendToBody?$position.offset(element):$position.position(element),scope.position.top=scope.position.top+element.prop("offsetHeight"),$document.bind("click",documentClickBind)):$document.unbind("click",documentClickBind)}),scope.select=function(date){if("today"===date){var today=new Date;angular.isDate(ngModel.$modelValue)?(date=new Date(ngModel.$modelValue),date.setFullYear(today.getFullYear(),today.getMonth(),today.getDate())):date=new Date(today.setHours(0,0,0,0))}scope.dateSelection(date)},scope.close=function(){scope.isOpen=!1,element[0].focus()};var $popup=$compile(popupEl)(scope);appendToBody?$document.find("body").append($popup):element.after($popup),scope.$on("$destroy",function(){$popup.remove(),element.unbind("keydown",keydown),$document.unbind("click",documentClickBind)}),element.bind("click",function(){scope.isOpen=!0,scope.$apply()})}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,template:["<ul class=\"datepicker dropdown-menu\" ng-style=\"{display: (isOpen && 'block') || 'none', top: position.top+'px', left: position.left+'px'}\" ng-keydown=\"keydown($event)\">","<li ng-transclude></li>",'<li ng-if="showButtonBar" class="button-bar">','<span class="btn-group">','<button type="button" class="btn btn-sm btn-info" ng-click="select(\'today\')">{{ getText(\'current\') }}</button>','<button type="button" class="btn btn-sm btn-danger" ng-click="select(null)">{{ getText(\'clear\') }}</button>',"</span>",'<button type="button" class="btn btn-sm btn-success pull-right" ng-click="close()">{{ getText(\'close\') }}</button>',"</li>","</ul>"].join(""),link:function(scope,element){element.bind("click",function(event){event.preventDefault(),event.stopPropagation()})}}}),angular.module("glams.ui.modal",[]).directive("modalPopup",function(){return{restrict:"A",scope:{modalPopup:"=modalPopup",modalPopupOnclose:"&",modalPopupTitle:"@"},link:function(scope,element,attrs){element.on("click",function(e){e.preventDefault(),e.stopPropagation();var options=scope.modalPopup||{};options.type="iframe",$.modal(scope.modalPopupTitle||"",attrs.href,options).on("close",function(){"function"==typeof scope.modalPopupOnclose&&scope.modalPopupOnclose()})})}}}).directive("aside",function(){return{restrict:"A",scope:{aside:"=aside",asideOnclose:"&",asideTitle:"@",asidePosition:"@"},link:function(scope,element,attrs){element.on("click",function(e){e.preventDefault(),e.stopPropagation();var options=scope.aside||{};options.position=scope.asidePosition||"right",options.type="iframe",$.aside(scope.asideTitle||"",attrs.href,options).on("close",function(){"function"==typeof scope.asideOnclose&&scope.asideOnclose()})})}}}),angular.module("glams.ui.grids",["ngSanitize"]).factory("CustomGridService",["$q","$http",function($q,$http){var CustomGridService={};return CustomGridService.loadDataSet=function(url,data,method,headers){var dObj=$q.defer();return $http({url:url,method:method||"POST",data:data,headers:headers||""}).success(function(data){dObj.resolve(data)}).error(function(data,status){dObj.reject({data:data,status:status})}),dObj.promise},CustomGridService.loadHierarchy=function(url,method,headers){var dObj=$q.defer();return $http({url:url,method:method||"GET",headers:headers||""}).success(function(data){dObj.resolve(data)}).error(function(data,status){dObj.reject({data:data,status:status})}),dObj.promise},CustomGridService.loadFilter=function(url,data,method,headers){var dObj=$q.defer();return $http({url:url,params:data,method:method||"GET",headers:headers||""}).success(function(data){dObj.resolve(data)}).error(function(data,status){dObj.reject({data:data,status:status})}),dObj.promise},CustomGridService.saveFilter=function(url,data,method,headers){var dObj=$q.defer();return $http({url:url,method:method||"GET",headers:headers||"",data:data}).success(function(data){dObj.resolve(data)}).error(function(data,status){dObj.reject({data:data,status:status})}),dObj.promise},CustomGridService.deleteFilter=function(url,data,method,headers){var dObj=$q.defer();return $http({url:url,method:method||"GET",headers:headers||"",params:data}).success(function(data){dObj.resolve(data)}).error(function(data,status){dObj.reject({data:data,status:status})}),dObj.promise},CustomGridService}]).filter("groupBy",function(){return function(input,group){var output=input;if(group){var _output=_.groupBy(input,group);output=[];for(o in _output)output.push({groupName:o,value:_output[o]})}return output}}).filter("groupfilter",function(){return function(input,search,limit,page,serverPaging){var output=[];return page=page||0,search=search.toLowerCase()||"",output=_.filter(input,function(row){return row[0].toString().toLowerCase().indexOf(search)>=0}),serverPaging?_.size(input)>limit&&limit>0?output.splice(0,limit):output:_.size(input)>limit&&limit>0?output.splice(page*limit,limit):output}}).filter("gridfilter",function(){return function(input,search,limit,page,serverPaging){var k,output=[];page=page||0,search=search.toLowerCase()||"";var hasSearch=!1;return output=_.filter(input,function(row){hasSearch=!1;for(k in row)"_hierarchy"!=k&&row[k]&&row[k].toString().toLowerCase().indexOf(search)>=0&&(hasSearch=!0);return hasSearch}),serverPaging?_.size(input)>limit&&limit>0?output.splice(0,limit):output:_.size(input)>limit&&limit>0?output.splice(page*limit,limit):output}}).filter("columnFilter",function(){return function(input,columnFilters){if(!columnFilters)return input;var k,output=[],keys=_.keys(columnFilters);return output=_.filter(input,function(row){var count=0;for(k in columnFilters){var s=$.trim(columnFilters[k]).toLowerCase();s?(row[k].toString().toLowerCase().indexOf(s)>=0||row[k]==s)&&count++:count++}return count==keys.length})}}).directive("grid",["CustomGridService",function(CustomGridService){var gridTemplate=['<div class="_grid-container">','<div class="_grid-loader" ng-if="grid.isLoading"><span><i class="fa fa-3x fa-refresh fa-spin"></i></span></div>','<div class="row _grid-control" ng-show="showTools">','<div class="col-md-6">','<div ng-if="pagination.showPaging">Page Size <input size="1" maxlength="3" type="text" class="_showperpage form-control" ng-model="pagination.pageSize"/> ',' <a ng-if="filter.showFilter" title="Column Filter" class="btn gbtn-default filter-btn" ng-class="{active:filter.columnFilterActive}" ng-click="filter.columnFilterActive=!filter.columnFilterActive"><i class="fa fa-filter"></i></a>',' <a ng-if="filter.showFilterExpression" class="btn gbtn-default filter-btn" ng-class="{active:filter.filterExpressionActive}" ng-click="filter.filterExpressionActive=!filter.filterExpressionActive"><i class="fa fa-lg fa-code"></i>   <i class="fa fa-filter"></i></a>',' <span class="btn-group filter-select" ng-show="filter.filterList.length>1 && filter.showFilterExpression">','<span class="btn gbtn-default filter-btn"><i class="fa fa-filter"></i></span>','<span class="btn gbtn-default filter-btn fselect">','<select ng-options="f.ID as f.Name for f in filter.filterList" ng-model="filter.currentFilterExpression" ng-change="filter.loadExpression($event)">',"</select>","</span>",'<span class="btn gbtn-default filter-btn" ng-click="filter.editExpression()"><i class="fa fa-pencil"></i></span>','<span class="btn gbtn-default filter-btn" ng-click="filter.deleteExpression()"><i class="fa fa-trash"></i></span>',"</span>","</div>","</div>",'<div class="col-md-6 text-right">',' <span ng-show="showGroupBy&&!grid.hierarchy">',' <span class="btn-group filter-select" title="Group by column value">','<span class="btn gbtn-default filter-btn"><i class="fa fa-th-large"></i></span>','<span class="btn gbtn-default filter-btn fselect">','<select ng-options="col.value as col.name for col in grid.columns" ng-model="groupBy"><option value=""> </option></select>',"</span>","</span>","</span>",' <input size="50" type="text" class="_search form-control" ng-model="filter.search"/>',"</div>","</div>","<div class=\"_grid-box\" ng-include=\"groupBy?'gridGroup.html':'gridDefault.html'\"></div>","</div>"].join("");return{restrict:"EA",replace:!0,require:"ngModel",transclude:!1,scope:{gridOptions:"=config",model:"=ngModel"},template:gridTemplate,link:function(){},controller:function($scope){$scope.templatePath=path+"Scripts/lib/ui-templates/",$scope.pagination={showPaging:!1,pageSize:0,currentPage:0,lastPage:0,pages:[0],totalRecords:0,init:function(){$scope.pagination.showPaging&&($scope.pagination.pageSize=$scope.gridOptions.pageSize||10),$scope.pagination.update(),$scope.pagination.currentPage=0},update:function(){var rowLength=$scope.grid.rows?$scope.grid.rows.length:0,rowLength=$scope.grid.rows?$scope.grid.rows.length:0,total=0;$scope.pagination.totalRecords=$scope.grid.serverPaging?$scope.pagination.totalRecords||$scope.gridOptions.totalRecords||rowLength:rowLength,total=$scope.pagination.totalRecords,$scope.pagination.pageSize=$scope.pagination.pageSize||10,$scope.pagination.pageSize>0?($scope.pagination.pages=_.range(Math.ceil(total/$scope.pagination.pageSize)),_.map($scope.pagination.pages,function(p){return p+1})):$scope.pagination.pages=[1],$scope.pagination.lastPage=$scope.pagination.pages[$scope.pagination.pages.length-1]},setCurrentPage:function(page){page<$scope.pagination.pages.length&&page>=0&&page!=$scope.pagination.currentPage&&($scope.pagination.currentPage=page,$scope.model=[],$scope.grid.serverPaging&&$scope.grid.loadDataSet())},getPages:function(){var pages=[];if($scope.pagination.lastPage-$scope.pagination.currentPage>=10)pages=_.clone($scope.pagination.pages).splice($scope.pagination.currentPage,10);else{var sIndex=$scope.pagination.currentPage+1-10;pages=_.clone($scope.pagination.pages).splice(sIndex>=0?sIndex:0,10)}return pages}},$scope.initLoad=!0,$scope.grid={resultSet:[],isLoading:!1,serverPaging:!1,hierarchy:!1,columns:[],rows:[],groupArray:[],showGrouping:!1,actions:[],rowActions:[],groupActions:[],generateColumns:function(){if($scope.gridOptions.columns&&$scope.gridOptions.columns.length)$scope.grid.columns=[],$.each($scope.gridOptions.columns,function(i,c){var obj={};obj.name=c.name||c.value,obj.value=c.value||c.name,obj.type=c.type||"",obj.url=c.url||"",obj.style=c.style||{},obj.modalProperties=c.modalProperties||{},obj.asideProperties=c.asideProperties||{},obj.modalTitle=c.modalTitle||"",obj.asideTitle=c.asideTitle||"",obj.dataType=c.dataType||"",$scope.grid.columns.push(obj),$scope.filter.columns[obj.value]=""});else if($scope.grid.rows&&$scope.grid.rows.length){$scope.grid.columns=[];for(var k in $scope.grid.rows[0])if("_hierarchy"!==k&&"$$hactive"!==k&&"_rowColor"!=k&&"$$hashKey"!=k){var obj={};obj.name=k,obj.value=k,obj.type="",$scope.grid.columns.push(obj),$scope.filter.columns[obj.value]=""}}return $scope.grid.columns},getUniqueColumnValues:function(col){return _.uniq(_.map($scope.grid.rows,_.iteratee(col.value)))},getURL:function(url,r){return r?url.replace(/\[(.*?)\]/g,function(a,b){return r[b]}):void 0},selectRow:function(row){$scope.model instanceof Array||($scope.model=[]);var index=$scope.grid.inSelection(row);0>index?($scope.gridOptions.multiSelect||($scope.model=[]),$scope.model.push(row)):$scope.model.splice(index,1)},inSelection:function(row){return $.inArray(row,$scope.model)},refresh:function(){$scope.grid.rows=$scope.gridOptions.rows,$scope.grid.generateColumns(),$scope.pagination.update()},loadDataSet:function(){$scope.grid.isLoading=!0;var defaultData={pagingEnabled:$scope.grid.serverPaging,pageSize:$scope.pagination.pageSize,pageIndex:$scope.pagination.currentPage};$scope.grid.extendedObject.filterExp=$scope.filter.buildQuery();var data=$.extend(!0,$scope.grid.extendedObject,defaultData);CustomGridService.loadDataSet($scope.gridOptions.dataUrl,data,$scope.method,$scope.headers).then(function(data){$scope.gridOptions.rows=data.rows||[],$scope.pagination.totalRecords=data.totalRecords,$scope.grid.isLoading=!1},function(){$scope.grid.isLoading=!1,console.error("unable to retrive data")})},loadHierarchy:function(row){return row.$$hactive=!row.$$hactive,$scope.grid.serverPaging&&row._hierarchy&&(row._hierarchy.rows=[]),row.$$hactive&&$scope.grid.hierarchy?void($scope.gridOptions.hierarchyUrl&&($scope.grid.isLoading=!0,CustomGridService.loadHierarchy($scope.grid.getURL($scope.gridOptions.hierarchyUrl,row),$scope.method,$scope.headers).then(function(config){row._hierarchy=config,config.headers=$scope.headers,config.extendedObject=config.extendedObject||{},config.extendedObject.parentID=row.JobID||0,config.showTools=!1,$scope.initLoad=!1,$scope.grid.isLoading=!1}))):!1},init:function(){$scope.gridOptions&&($scope.method=$scope.gridOptions.method,$scope.headers=$scope.gridOptions.headers,$scope.groupBy=$scope.gridOptions.groupBy,$scope.actionRef=$scope.gridOptions.actionReference,$scope.showTools=$scope.gridOptions.showTools===!1?!1:!0,$scope.showGroupBy=$scope.gridOptions.showGroupBy===!1?!1:!0,$scope.showHeaders=$scope.gridOptions.showHeaders===!1?!1:!0,$scope.filter.showFilter=0==$scope.gridOptions.filter?!1:!0,$scope.filter.showFilterExpression=$scope.gridOptions.showFilterExpression||!1,$scope.grid.extendedObject=$scope.gridOptions.extendedObject||{},$scope.grid.showGrouping=$scope.gridOptions.showGrouping||!1,$scope.grid.serverPaging=$scope.gridOptions.serverPaging||!1,$scope.grid.hierarchy=$scope.gridOptions.hierarchy||!1,$scope.pagination.pageSize=$scope.gridOptions.pageSize||10,$scope.pagination.showPaging=$scope.gridOptions.showPaging===!1?!1:!0,$scope.grid.actions=$scope.gridOptions.actions||[],$scope.grid.groupActions=[],$scope.grid.rowActions=[],$scope.grid.rows=[],$.each($scope.grid.actions,function(i,action){action.isGeneralAction=!!action.isGeneralAction,action.isGeneralAction?$scope.grid.groupActions.push(action):$scope.grid.rowActions.push(action)}),$scope.grid.serverPaging||$scope.gridOptions.dataUrl?$scope.filter.showFilterExpression?$scope.filter.init():$scope.grid.loadDataSet():$scope.grid.rows=$scope.gridOptions.rows||[])},actionHandler:function($event,isGeneralAction,actionName,row){if("function"==typeof actionName)actionName($event,isGeneralAction?$scope.model:[row],$scope);else{var action=$scope.actionRef[actionName];"function"==typeof action&&action($event,isGeneralAction?$scope.model:[row],$scope)}}},$scope.groupArray=[],$scope.setGroup=function(group){var o,_output=_.groupBy($scope.grid.rows,group),output=[];for(o in _output)output.push([o,_output[o],!1]);$scope.grid.groupArray=output},$scope.sort={column:"",reverse:!1},$scope.filter={search:"",showFilter:!0,showFilterExpression:!1,columnFilterActive:!1,filterExpressionActive:!1,currentFilterExpression:0,filterExpression:[],filterList:[{ID:0}],setAsDefault:!1,columns:{},getDataType:function(colValue){var dType="";return $.each($scope.grid.columns,function(i,col){col.value==colValue&&(dType=col.dataType||"")}),dType},columnChange:function(exp){exp.dataType=$scope.filter.getDataType(exp.column),exp.value=""},addChild:function(index,exp){var obj={"boolean":"",column:"",operator:"",dataType:"",value1:"",value2:"",parent:exp||$scope.filter.filterExpression,children:[]};obj.parent.splice(index+1,0,obj)},deleteChild:function(exp){var index=$.inArray(exp,exp.parent);index>=0&&exp.parent.splice(index,1)},editExpression:function(){$scope.filter.currentFilterExpression>0?$scope.filter.filterExpressionActive=!0:$scope.filter.filterExpression=[]},deleteExpression:function(){var data={id:$scope.filter.currentFilterExpression};CustomGridService.deleteFilter(path+"api/grid/DeleteGridFilter",data,"POST",$scope.headers).then(function(){$scope.filter.init()})},buildQuery:function(){function iterate(e){var str="";if(e.column){switch(str=" "+e.boolean+" (["+e.column+"] ",e.operator){case"Between":case"NotBetween":str="date"==e.dataType?str+e.operator.toUpperCase()+" '"+moment(e.value1).format("YYYY-MM-DD")+"' AND '"+moment(e.value2).format("YYYY-MM-DD")+"'":str+e.operator.toUpperCase()+" '"+e.value1+"' AND '"+e.value2+"'";break;case"IsNull":str=" "+e.boolean+" (["+e.column+"] IS NULL";break;case"IsNotNull":str=" "+e.boolean+" (["+e.column+"] IS NOT NULL";break;case"EqualTo":str=" "+e.boolean+" (["+e.column+"] = '"+e.value1+"'";break;case"NotEqualTo":str=" "+e.boolean+" (["+e.column+"] <> '"+e.value1+"'";break;case"Like":str=" "+e.boolean+" (["+e.column+"] LIKE '%"+e.value1+"%'";break;default:str=str+e.value1+"'"}e.children.length&&$.each(e.children,function(i,exp){str+=iterate(exp)}),str+=") "}return str}var queryString="";return $.each($scope.filter.filterExpression,function(i,e){e.column&&(queryString+=iterate(e))}),queryString},applyFilter:function(){$scope.grid.loadDataSet()},prepareFilterSave:function(){var expressions=[];return function iterate(exp,dest){$.each(exp,function(i,e){var obj={"boolean":e.boolean,column:e.column,operator:e.operator,dataType:e.dataType,value1:e.value1,value2:e.value2,children:[]};e.children.length&&iterate(e.children,obj.children),dest.push(obj)})}($scope.filter.filterExpression,expressions),expressions},getFilterById:function(id){var fObj={};return $.each($scope.filter.filterList,function(i,filter){filter.ID==id&&(fObj=filter)}),fObj},saveFilter:function(saveAs){var id=0;if($scope.filter.currentFilterExpression>0&&!saveAs){id=$scope.filter.currentFilterExpression;var fObj=$scope.filter.getFilterById(id);$scope.filter.saveHandler(id,fObj.Name,JSON.stringify($scope.filter.prepareFilterSave()),$scope.filter.setAsDefault)}else $.prompt("Enter Filter Name",{onComplete:function(res,value){if("Ok"==res){var fname=$.trim(value);if(""==fname)return!1;$scope.filter.saveHandler(id,fname,JSON.stringify($scope.filter.prepareFilterSave()),$scope.filter.setAsDefault)}}})},saveHandler:function(id,fname,fvalue,isDefault){var data={};data.ID=id,data.Name=fname,data.FilterType=1,data.GridID=$scope.grid.extendedObject.GridID,data.UserID=null,data.UpdatedOn=null,data.Expression=fvalue,data.IsDefault=!!isDefault,CustomGridService.saveFilter(path+"api/grid/CreateOrUpdateFilter",data,"POST",$scope.headers).then(function(){$.notify("Filter saved successfully",{type:"success"}),$scope.filter.init()})},loadExpression:function(){if($scope.filter.currentFilterExpression>0){var fObj=$scope.filter.getFilterById($scope.filter.currentFilterExpression);fObj&&($scope.filter.filterExpression=$.parseJSON(fObj.Expression),$scope.filter.currentFilterExpression=fObj.ID,$scope.filter.setAsDefault=fObj.IsDefault,function iterate(exp){$.each(exp,function(i,e){e.parent=exp,e.children.length&&iterate(e.children)})}($scope.filter.filterExpression))}else $scope.filter.filterExpression=[],$scope.filter.setAsDefault=!1;$scope.grid.loadDataSet()},init:function(){if($scope.filter.showFilterExpression){$scope.filter.filterExpression=[],$scope.filter.filterExpressionActive=!1,$scope.filter.currentFilterExpression=0,$scope.filter.setAsDefault=!1;var data={gridId:$scope.grid.extendedObject.GridID};CustomGridService.loadFilter(path+"api/grid/GetGridFilters",data,"GET",$scope.headers).then(function(data){$scope.filter.filterList=data,$scope.filter.filterList.splice(0,0,{ID:0,Name:""}),$scope.initLoad=!1;var hasDefault=!1;$.each($scope.filter.filterList,function(){this.IsDefault&&($scope.filter.currentFilterExpression=this.ID,hasDefault=!0)}),hasDefault?$scope.filter.loadExpression():$scope.grid.loadDataSet()})}}},$scope.orderby=function(col){$scope.sort.reverse=$scope.sort.column==col?!$scope.sort.reverse:!1,$scope.sort.column=col},$scope.$watch("gridOptions",function(){$scope.grid.init(),$scope.pagination.init()}),$scope.$watch("gridOptions.rows",function(){$scope.grid.refresh()}),$scope.$watch("groupBy",function(){$scope.groupBy&&($scope.setGroup($scope.groupBy),$scope.pagination.update())}),$scope.$watch("filter",function(){$scope.pagination.update()}),$scope.$watch("pagination.pageSize",function(){$scope.pagination.update(),!$scope.grid.serverPaging||$scope.grid.isLoading||$scope.initLoad||$scope.grid.loadDataSet()})}}}]),angular.module("glams.ui.upload",[]).factory("GlamsFileUploadService",["$q","$http",function($q,$http){var GlamsFileUploadService={};return GlamsFileUploadService.getData=function(url){var dObj=$q.defer();return $http.get(url).success(function(data){dObj.resolve(data)}).error(function(data,status){dObj.reject({data:data,status:status})}),dObj.promise},GlamsFileUploadService}]).directive("fileUpload",["GlamsFileUploadService",function(){var template=['<div class="file-upload">','<div class="input-group">','<div class="form-control" ng-if="!multiple"><i class="fa fa-file" ng-if="FileUpload.uploadingFiles.length"></i>&nbsp;{{FileUpload.uploadingFiles[FileUpload.uploadingFiles.length-1].FileName}}<i ng-if="allowedTypes" class="hint-text">(Allowed: {{allowedTypes}})</i></div>','<div class="form-control" ng-if="multiple"><i class="fa fa-file" ng-if="FileUpload.uploadingFiles.length"></i> {{FileUpload.uploadingFiles.length}} file<span ng-show="FileUpload.uploadingFiles.length>1">s</span> Selcted <i class="hint-text" ng-if="allowedTypes">(Allowed: {{allowedTypes}})</i></div>','<div class="input-group-btn">','<button type="button" class="btn gbtn-default" ng-click="FileUpload.clear(true)" ng-if="FileUpload.uploadingFiles.length>0"><i class="fa fa-times"></i> Remove All</button>','<div class="btn gbtn-default"> <i class="glyphicon glyphicon-folder-open"></i> &nbsp;Browse... <input name="file" type="file" class="file"></div>',"</div>","</div>",'<div class="file-upload-container" ng-init="init()">',"<ul>",'<li ng-repeat="file in FileUpload.uploadingFiles">','<div class="progress">','<div class="progress-bar progress-bar-success progress-bar-striped" ng-class="{active:file.Progress<100}"  role="progressbar" ng-style="FileUpload.getStyle(file)">','<span class="file-name">{{file.FileName}}</span>','<span class="progress-txt" ng-if="file.Progress<100">{{file.Progress}}% Complete</span>','<span class="progress-txt" ng-if="file.Progress>=100">{{file.Status}}</span>','<i class="abort fa fa-times-circle" ng-click="FileUpload.abort(file)"></i>',"</div>","</div>","</li>","</ul>","</div>","</div>"].join("");return{restrict:"EA",replace:!0,require:"ngModel",transclude:!1,template:template,scope:{multiple:"=multiple",serviceUrl:"@serviceUrl",allowedTypes:"@allowedTypes",maxFiles:"=maxFiles",model:"=ngModel"},controller:function($scope,$element,$attrs,$timeout){$scope.init=function(){setTimeout($scope.FileUpload.init,0)},$scope.FileUpload={uploadingFiles:[],Form:null,getStyle:function(file){return{width:file.Progress+"%"}},clear:function(deepClear){$($scope.FileUpload.uploadingFiles).each(function(i,f){f.Connection&&f.Connection.stop(),f.Frame&&$(f.Frame).remove()}),$scope.FileUpload.uploadingFiles.splice(0,$scope.FileUpload.uploadingFiles.length),$scope.model=[],deepClear&&($.browser.msie?$scope.FileUpload.element.replaceWith($scope.FileUpload.element.clone(!0)):$scope.FileUpload.element[0].value="")},abort:function(fileObj){if(fileObj.Progress<100){fileObj.uploadObj&&fileObj.uploadObj.abort(),fileObj.Connection&&fileObj.Connection.stop(),fileObj.Frame&&$(fileObj.Frame).remove(),console.log($scope.FileUpload.uploadingFiles,fileObj);var index=$.inArray(fileObj,$scope.FileUpload.uploadingFiles);index>=0&&$scope.FileUpload.uploadingFiles.splice(index,1)}},init:function(){$scope.FileUpload.element=$element.find(":file").filter(":visible"),$scope.FileUpload.Form=$element.parents("form").eq(0),$scope.model=[],$.browser.msie?$scope.FileUpload.element[0].attachEvent("onpropertychange",function(event){"value"===event.propertyName&&$scope.FileUpload.FileSelected()}):$scope.FileUpload.element.bind("change",function(){$scope.FileUpload.FileSelected()})},FileSelected:function(){var elm=$scope.FileUpload.element[0];if($scope.multiple&&$scope.maxFiles&&$scope.FileUpload.uploadingFiles.length==$scope.maxFiles)return $.alert("Maximum <b>"+$scope.maxFiles+"</b> files allowed to upload",{icon:"error"}),elm.value="",!1;var fileArr=[],files=elm.files?elm.files[0]:elm.value,fileName="string"==typeof files?files.substring(files.lastIndexOf("\\")+1):files.name;if($scope.multiple||$scope.FileUpload.clear(),$scope.allowedTypes){var fileTypes=new RegExp("^.*.("+$scope.allowedTypes.replace(/\,/gi,"|")+")$");if(!fileTypes.test(fileName))return $.alert("Allowed file types: <b>"+$scope.allowedTypes+"</b>",{icon:"error"}),elm.value="",!1}fileArr.push(fileName),setTimeout(function(){$scope.$apply(function(){$.each(fileArr,function(i,file){if(""!=file){{var fileObj={FileName:file,Progress:0,Status:"",Frame:null,FileId:0,Connection:null};file.substring(file.lastIndexOf(".")+1)}$scope.FileUpload.uploadingFiles.push(fileObj),$scope.FileUpload.initUpload(fileObj,elm)}})})},0)},initUpload:function(currentFileObj,felm){var hub=$.signalR.hub.createHubProxies();hub.uploadHub.client.updateProgress=function(pct){currentFileObj.Progress=(+pct+1).toFixed(2);var progress=Math.round(currentFileObj.Progress);currentFileObj.Status=progress>=100?"Creating previews....":"Uploading...",$scope.$apply()},console.log(currentFileObj.Connection),currentFileObj.Connection=hub.uploadHub.connection,hub.uploadHub.connection.start().done(function(){var iframe=$("<iframe/>"),targetId=hub.uploadHub.connection.id;currentFileObj.Frame=iframe,$scope.FileUpload.Form.attr("action",$scope.serviceUrl+"?id="+targetId),iframe.prop({id:targetId,name:targetId}).hide(),$scope.FileUpload.Form.parent().append(iframe),$scope.FileUpload.Form.attr("target",targetId),iframe.on("load",function(){currentFileObj.Status="";var fileObj=iframe.contents().find("string").html();$scope.multiple?$scope.model.push(fileObj):$scope.model=[fileObj],setTimeout(function(){hub.uploadHub.connection.stop(),$scope.$apply(),iframe.remove()},200)}),$scope.FileUpload.Form.attr("method","post"),$scope.FileUpload.Form.attr("enctype","multipart/form-data"),$scope.FileUpload.Form.submit(),$timeout(function(){$(felm).val("")},200)}).fail(function(){console.log("Could not connect")})}}},link:function(){}}}]),angular.module("glams.ui.colorpicker",[]).factory("Helper",function(){return{closestSlider:function(elem){var matchesSelector=elem.matches||elem.webkitMatchesSelector||elem.mozMatchesSelector||elem.msMatchesSelector;return matchesSelector.bind(elem)("I")?elem.parentNode:elem},getOffset:function(elem,fixedPosition){for(var x=0,y=0,scrollX=0,scrollY=0;elem&&!isNaN(elem.offsetLeft)&&!isNaN(elem.offsetTop);)x+=elem.offsetLeft,y+=elem.offsetTop,fixedPosition||"BODY"!==elem.tagName?(scrollX+=elem.scrollLeft,scrollY+=elem.scrollTop):(scrollX+=document.documentElement.scrollLeft||elem.scrollLeft,scrollY+=document.documentElement.scrollTop||elem.scrollTop),elem=elem.offsetParent;return{top:y,left:x,scrollX:scrollX,scrollY:scrollY}},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[2.55*execResult[1],2.55*execResult[2],2.55*execResult[3],execResult[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)]}}]}}).factory("Color",["Helper",function(Helper){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var rgb=this.toRGB();return"rgb("+rgb.r+","+rgb.g+","+rgb.b+")"},rgba:function(){var rgb=this.toRGB();return"rgba("+rgb.r+","+rgb.g+","+rgb.b+","+rgb.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(r,g,b,a){r/=255,g/=255,b/=255;var H,S,V,C;return V=Math.max(r,g,b),C=V-Math.min(r,g,b),H=0===C?null:V===r?(g-b)/C:V===g?(b-r)/C+2:(r-g)/C+4,H=(H+360)%6*60/360,S=0===C?0:C/V,{h:H||1,s:S,b:V,a:a||1}},setColor:function(val){val=val.toLowerCase();for(var key in Helper.stringParsers)if(Helper.stringParsers.hasOwnProperty(key)){var parser=Helper.stringParsers[key],match=parser.re.exec(val),values=match&&parser.parse(match);if(values)return this.value=this.RGBtoHSB.apply(null,values),!1}},setHue:function(h){this.value.h=1-h},setSaturation:function(s){this.value.s=s},setLightness:function(b){this.value.b=1-b},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(h,s,b,a){h||(h=this.value.h,s=this.value.s,b=this.value.b),h*=360;
var R,G,B,X,C;return h=h%360/60,C=b*s,X=C*(1-Math.abs(h%2-1)),R=G=B=b-C,h=~~h,R+=[C,X,0,0,X,C][h],G+=[X,C,C,X,0,0][h],B+=[0,0,X,C,C,X][h],{r:Math.round(255*R),g:Math.round(255*G),b:Math.round(255*B),a:a||this.value.a}},toHex:function(h,s,b,a){var rgb=this.toRGB(h,s,b,a);return"#"+(1<<24|parseInt(rgb.r,10)<<16|parseInt(rgb.g,10)<<8|parseInt(rgb.b,10)).toString(16).substr(1)}}}]).factory("Slider",["Helper",function(Helper){var slider={maxLeft:0,maxTop:0,callLeft:null,callTop:null,knob:{top:0,left:0}},pointer={};return{getSlider:function(){return slider},getLeftPosition:function(event){return Math.max(0,Math.min(slider.maxLeft,slider.left+((event.pageX||pointer.left)-pointer.left)))},getTopPosition:function(event){return Math.max(0,Math.min(slider.maxTop,slider.top+((event.pageY||pointer.top)-pointer.top)))},setSlider:function(event,fixedPosition){var target=Helper.closestSlider(event.target),targetOffset=Helper.getOffset(target,fixedPosition);slider.knob=target.children[0].style,slider.left=event.pageX-targetOffset.left-window.pageXOffset+targetOffset.scrollX,slider.top=event.pageY-targetOffset.top-window.pageYOffset+targetOffset.scrollY,pointer={left:event.pageX,top:event.pageY}},setSaturation:function(event,fixedPosition){slider={maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},this.setSlider(event,fixedPosition)},setHue:function(event,fixedPosition){slider={maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},this.setSlider(event,fixedPosition)},setAlpha:function(event,fixedPosition){slider={maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"},this.setSlider(event,fixedPosition)},setKnob:function(top,left){slider.knob.top=top+"px",slider.knob.left=left+"px"}}}]).directive("colorpicker",["$document","$compile","Color","Slider","Helper",function($document,$compile,Color,Slider,Helper){return{require:"?ngModel",restrict:"A",link:function($scope,elem,attrs,ngModel){var sliderAlpha,thisFormat=attrs.colorpicker?attrs.colorpicker:"hex",position=angular.isDefined(attrs.colorpickerPosition)?attrs.colorpickerPosition:"bottom",fixedPosition=angular.isDefined(attrs.colorpickerFixedPosition)?attrs.colorpickerFixedPosition:!1,target=angular.isDefined(attrs.colorpickerParent)?elem.parent():angular.element(document.body),withInput=angular.isDefined(attrs.colorpickerWithInput)?attrs.colorpickerWithInput:!1,inputTemplate=withInput?'<input type="text" name="colorpicker-input">':"",template='<div class="colorpicker dropdown"><div class="dropdown-menu"><colorpicker-saturation><i></i></colorpicker-saturation><colorpicker-hue><i></i></colorpicker-hue><colorpicker-alpha><i></i></colorpicker-alpha><colorpicker-preview></colorpicker-preview>'+inputTemplate+'<button class="close close-colorpicker">&times;</button></div></div>',colorpickerTemplate=angular.element(template),pickerColor=Color,sliderHue=colorpickerTemplate.find("colorpicker-hue"),sliderSaturation=colorpickerTemplate.find("colorpicker-saturation"),colorpickerPreview=colorpickerTemplate.find("colorpicker-preview"),pickerColorPointers=colorpickerTemplate.find("i");if($compile(colorpickerTemplate)($scope),withInput){var pickerColorInput=colorpickerTemplate.find("input");pickerColorInput.on("mousedown",function(event){event.stopPropagation()}).on("keyup",function(event){var newColor=this.value;elem.val(newColor),ngModel&&$scope.$apply(ngModel.$setViewValue(newColor)),event.stopPropagation(),event.preventDefault()}),elem.on("keyup",function(){pickerColorInput.val(elem.val())})}var bindMouseEvents=function(){$document.on("mousemove",mousemove),$document.on("mouseup",mouseup)};"rgba"===thisFormat&&(colorpickerTemplate.addClass("alpha"),sliderAlpha=colorpickerTemplate.find("colorpicker-alpha"),sliderAlpha.on("click",function(event){Slider.setAlpha(event,fixedPosition),mousemove(event)}).on("mousedown",function(event){Slider.setAlpha(event,fixedPosition),bindMouseEvents()})),sliderHue.on("click",function(event){Slider.setHue(event,fixedPosition),mousemove(event)}).on("mousedown",function(event){Slider.setHue(event,fixedPosition),bindMouseEvents()}),sliderSaturation.on("click",function(event){Slider.setSaturation(event,fixedPosition),mousemove(event)}).on("mousedown",function(event){Slider.setSaturation(event,fixedPosition),bindMouseEvents()}),fixedPosition&&colorpickerTemplate.addClass("colorpicker-fixed-position"),colorpickerTemplate.addClass("colorpicker-position-"+position),target.append(colorpickerTemplate),ngModel&&(ngModel.$render=function(){elem.val(ngModel.$viewValue)},$scope.$watch(attrs.ngModel,function(){update()})),elem.on("$destroy",function(){colorpickerTemplate.remove()});var previewColor=function(){try{colorpickerPreview.css("backgroundColor",pickerColor[thisFormat]())}catch(e){colorpickerPreview.css("backgroundColor",pickerColor.toHex())}sliderSaturation.css("backgroundColor",pickerColor.toHex(pickerColor.value.h,1,1,1)),"rgba"===thisFormat&&(sliderAlpha.css.backgroundColor=pickerColor.toHex())},mousemove=function(event){var left=Slider.getLeftPosition(event),top=Slider.getTopPosition(event),slider=Slider.getSlider();Slider.setKnob(top,left),slider.callLeft&&pickerColor[slider.callLeft].call(pickerColor,left/100),slider.callTop&&pickerColor[slider.callTop].call(pickerColor,top/100),previewColor();var newColor=pickerColor[thisFormat]();return elem.val(newColor),ngModel&&$scope.$apply(ngModel.$setViewValue(newColor)),withInput&&pickerColorInput.val(newColor),!1},mouseup=function(){$document.off("mousemove",mousemove),$document.off("mouseup",mouseup)},update=function(){pickerColor.setColor(elem.val()),pickerColorPointers.eq(0).css({left:100*pickerColor.value.s+"px",top:100-100*pickerColor.value.b+"px"}),pickerColorPointers.eq(1).css("top",100*(1-pickerColor.value.h)+"px"),pickerColorPointers.eq(2).css("top",100*(1-pickerColor.value.a)+"px"),previewColor()},getColorpickerTemplatePosition=function(){var positionValue,positionOffset=Helper.getOffset(elem[0]);return angular.isDefined(attrs.colorpickerParent)&&(positionOffset.left=0,positionOffset.top=0),"top"===position?positionValue={top:positionOffset.top-147,left:positionOffset.left}:"right"===position?positionValue={top:positionOffset.top,left:positionOffset.left+126}:"bottom"===position?positionValue={top:positionOffset.top+elem[0].offsetHeight+2,left:positionOffset.left}:"left"===position&&(positionValue={top:positionOffset.top,left:positionOffset.left-150}),{top:positionValue.top+"px",left:positionValue.left+"px"}},documentMousedownHandler=function(){hideColorpickerTemplate()};elem.on("click",function(){update(),colorpickerTemplate.addClass("colorpicker-visible").css(getColorpickerTemplatePosition()),$document.on("mousedown",documentMousedownHandler)}),colorpickerTemplate.on("mousedown",function(event){event.stopPropagation(),event.preventDefault()});var emitEvent=function(name){ngModel&&$scope.$emit(name,{name:attrs.ngModel,value:ngModel.$modelValue})},hideColorpickerTemplate=function(){colorpickerTemplate.hasClass("colorpicker-visible")&&(colorpickerTemplate.removeClass("colorpicker-visible"),emitEvent("colorpicker-closed"),$document.off("mousedown",documentMousedownHandler))};colorpickerTemplate.find("button").on("click",function(){hideColorpickerTemplate()})}}}]),angular.module("glams.ui.tree",["ngSanitize"]).factory("TreeService",["$q","$http",function($q,$http){var TreeService={};return TreeService.loadTreeData=function(action){var dObj=$q.defer();return $http.get(action).success(function(data){dObj.resolve(data)}),dObj.promise},TreeService}]).directive("dynamicHtml",function($compile){return{restrict:"A",replace:!0,scope:{dynamic:"=dynamicHtml",cscope:"=cscope"},link:function(scope,element){scope.$watch("dynamic",function(html){element.html(html),$compile(element.contents())(scope.cscope)})}}}).directive("tree",["TreeService",function(TreeService){return{template:['<div class="_tree-container" ng-init="init()">','<div class="_tree-head"><a href="#" ng-click="toggleTree(true)"><i class="fa fa-plus"></i> Expand All</a> / <a href="#" ng-click="toggleTree(false)"><i class="fa fa-minus"></i> Collapse All</a></div>',"<ul>",'<li ng-repeat="tree in tree" class="_tree" ng-class="{expand:tree._expand}" ng-init="tree._expand=!!tree._expand">','<i class="collapse-icon fa fa-{{tree._expand?\'minus\':\'plus\'}}" ng-if="tree.tree.length" ng-click="tree._expand=!tree._expand"></i>','<div cscope="this" dynamic-html="getDataTemplate()"></div>','<div ng-if="tree.tree.length" ng-show="tree._expand">','<div ng-include="getTreeTemplate()"></div>',"</div>","</li>","</ul>","</div>"].join(""),restrict:"EA",replace:!0,scope:{model:"=ngModel",treeConfig:"=config"},controller:function($scope){$scope.tree=$scope.treeConfig.data,$scope.getTreeTemplate=function(){return path+"Scripts/lib/ui-templates/tree.html"},$scope.init=function(){$scope.treeConfig.dataUrl?TreeService.loadTreeData($scope.treeConfig.dataUrl).then(function(data){$scope.tree=data,$scope.toggleTree($scope.treeConfig.expandAll)}):$scope.toggleTree($scope.treeConfig.expandAll)},$scope.getDataTemplate=function(){return $scope.treeConfig.template||"{{t}}"},$scope.toggleTree=function(expand){!function iterate(tree){$.each(tree,function(i,t){t.tree&&t.tree.length&&(t._expand=!!expand,iterate(t.tree))})}($scope.tree)}}}}]),angular.module("glams.module.validation",[]).service("Validator",function(){var validator=this;validator.addRule=function(name,fn){validator[name]=fn},validator.empty=function(value){return/.+/.test(value)},validator.number=function(value){return/^[-+]?[0-9]*[\.]?[0-9]*$/.test(value)},validator.email=function(value){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(value)},validator.url=function(value){return/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/.test(value)},validator.alphanum=function(value){return/^[a-zA-Z0-9]*$/.test(value)},validator.alphabets=function(){return/^[a-zA-Z]*$/.test(value)}})}(jQuery,angular,window);